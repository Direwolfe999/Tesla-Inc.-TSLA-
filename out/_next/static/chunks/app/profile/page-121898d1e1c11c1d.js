(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[178],{2719:function(e,s,a){Promise.resolve().then(a.bind(a,1380))},1380:function(e,s,a){"use strict";a.r(s);var t=a(7437),l=a(2265),r=a(6634),i=a(9376),n=a(6705),o=a(4084);o.kL.register(...o.zX),s.default=()=>{let e=(0,i.useRouter)(),[s,a]=(0,l.useState)(null),[o,d]=(0,l.useState)(null),[c,u]=(0,l.useState)(""),[m,h]=(0,l.useState)(""),[g,p]=(0,l.useState)(""),[x,b]=(0,l.useState)(0),[f,j]=(0,l.useState)(0),[v,y]=(0,l.useState)(0),[N,w]=(0,l.useState)("overview"),[C,k]=(0,l.useState)([]),[S,O]=(0,l.useState)(null),[P,I]=(0,l.useState)(!1),[_,A]=(0,l.useState)([]);(0,l.useEffect)(()=>{r.O.auth.getSession().then(s=>{var t;let{data:l}=s;if(!l.session)return e.push("/auth/signin");a(l.session.user),E(null===(t=l.session.user)||void 0===t?void 0:t.id)})},[]);let E=async e=>{try{let{data:s}=await r.O.from("profiles").select("*").eq("id",e).single();d(s),u(s.name||""),h(s.email||""),p(s.profile_pic_url||""),b(s.portfolio_value||0),j(s.returns||0),y(s.rank||0);let{data:a}=await r.O.from("user_assets").select("*").eq("user_id",e);k(a||[]);let{data:t}=await r.O.from("transactions").select("*").eq("user_id",e);A(t||[])}catch(e){console.error(e)}},z=async e=>{let a=e.target.files[0],t=["image/jpeg","image/png","image/gif","image/webp","image/svg+xml","image/bmp","image/tiff"];if(!t.includes(a.type)){alert("Invalid file type. Allowed types: "+t.join(", "));return}if(a.size>5242880){alert("File too large (max 5MB)");return}let{data:l}=await r.O.storage.from("Profile-pics").upload("".concat(null==s?void 0:s.id,"/").concat(a.name),a);l?p("".concat("https://hvdssadhwzrazjxvdpce.supabase.co/storage/v1/object/public/","Profile-pics/").concat(null==s?void 0:s.id,"/").concat(a.name)):console.error("Error uploading image"),console.log("Saving profile pic:",g)},M=async()=>{try{await r.O.from("profiles").update({name:c,email:m,profile_pic_url:g}).eq("id",null==s?void 0:s.id),alert("Profile updated!"),e.refresh()}catch(e){console.error("Error updating profile:",e)}},[q,J]=(0,l.useState)(""),[Z,U]=(0,l.useState)(""),[F,W]=(0,l.useState)(""),D=async()=>{var e,s;if(Z!==F){alert("Passwords do not match");return}let a=null===(e=(await r.O.auth.getSession()).data.session)||void 0===e?void 0:e.user;if(!(null==a?void 0:a.email)){alert("User not found or email missing");return}let{error:t}=await r.O.auth.signInWithPassword({email:null!==(s=null==a?void 0:a.email)&&void 0!==s?s:"",password:q});if(t){alert("Current password is incorrect");return}let{error:l}=await r.O.auth.updateUser({password:Z});l?console.error("Error updating password:",l):alert("Password updated!")},[H,R]=(0,l.useState)(!1),[T,V]=(0,l.useState)(!1),B=async e=>{"email"===e&&R(!H),"sms"===e&&V(!T),await r.O.from("profiles").update({[e]:"email"===e?!H:!T}).eq("id",null==s?void 0:s.id)},[L,X]=(0,l.useState)(!1),[Q,Y]=(0,l.useState)(null),[G,$]=(0,l.useState)(null),[K,ee]=(0,l.useState)(null),es=async()=>{var e;let{data:s,error:a}=await r.O.auth.mfa.listFactors();if(a){console.error(a);return}let t=null!==(e=null==s?void 0:s.all)&&void 0!==e?e:[];if(t.length>0){let e=t[0].id;await r.O.auth.mfa.unenroll({factorId:e}),X(!1)}else{let{data:e,error:s}=await r.O.auth.mfa.enroll({factorType:"totp"});if(s){console.error(s);return}let{data:a,error:t}=await r.O.auth.mfa.challenge({factorId:e.id});if(t){console.error(t);return}ee(a.id),Y(e.totp.qr_code),$(e.id)}},ea=async e=>{if(!G||!K)return;let{error:s}=await r.O.auth.mfa.verify({factorId:G,challengeId:K,code:e});s?console.error(s):(X(!0),Y(null))},et=async()=>{let{data:{user:e}}=await r.O.auth.getUser();P?(await r.O.from("price_alerts").update({status:"cancelled"}).eq("user_id",null==e?void 0:e.id),I(!1),localStorage.setItem("priceAlertEnabled","false")):(await r.O.from("price_alerts").insert({user_id:null==e?void 0:e.id,status:"active"}),I(!0),localStorage.setItem("priceAlertEnabled","true"))};(0,l.useEffect)(()=>{(async()=>{let{data:{user:e}}=await r.O.auth.getUser(),{data:s,error:a}=await r.O.from("price_alerts").select("status").eq("user_id",null==e?void 0:e.id).order("updated_at",{ascending:!1}).limit(1);a?console.error(a):I(s.length>0&&"active"===s[0].status)})()},[]);let el=e=>{O(e)},[er,ei]=(0,l.useState)([]);(0,l.useEffect)(()=>{(async()=>{var e;let{data:s,error:a}=await r.O.auth.getUserIdentities();a&&console.error(a),ei(null!==(e=null==s?void 0:s.identities)&&void 0!==e?e:[])})()},[]);let en=async()=>{await r.O.auth.admin.deleteUser(null==s?void 0:s.id),await r.O.auth.signOut(),window.location.href="/login"};return(0,t.jsxs)("div",{className:"max-w-4xl mx-auto p-4 md:p-6 mt-20 md:mt-40 text-white",children:[(0,t.jsx)("h1",{className:"text-2xl md:text-3xl font-bold mb-6",children:"Profile"}),(0,t.jsxs)("div",{className:"bg-gray-800 p-4 md:p-6 rounded-lg shadow-lg",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row items-center gap-4 mb-4",children:[(0,t.jsxs)("div",{className:"relative group w-24 h-24 md:w-32 md:h-32",children:[(0,t.jsx)("img",{src:g||"/default-avatar.jpg",alt:"Profile Pic",className:"w-full h-full rounded-full object-cover"}),(0,t.jsxs)("div",{className:"absolute inset-0 bg-black bg-opacity-50 rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,t.jsx)("span",{className:"text-white text-2xl",children:"+"}),(0,t.jsx)("input",{type:"file",className:"absolute inset-0 opacity-0 cursor-pointer",onChange:z})]})]}),(0,t.jsxs)("div",{className:"text-center md:text-left",children:[(0,t.jsx)("h2",{className:"text-lg md:text-xl font-bold",children:c}),(0,t.jsx)("p",{className:"text-gray-400",children:"Verified Investor"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,t.jsxs)("div",{className:"bg-gray-700 p-4 rounded-lg",children:[(0,t.jsx)("p",{className:"text-gray-400",children:"Portfolio Value"}),(0,t.jsxs)("p",{className:"text-xl font-bold",children:["$",x]})]}),(0,t.jsxs)("div",{className:"bg-gray-700 p-4 rounded-lg",children:[(0,t.jsx)("p",{className:"text-gray-400",children:"Returns"}),(0,t.jsxs)("p",{className:"text-xl font-bold",children:[f,"%"]})]}),(0,t.jsxs)("div",{className:"bg-gray-700 p-4 rounded-lg",children:[(0,t.jsx)("p",{className:"text-gray-400",children:"Rank"}),(0,t.jsxs)("p",{className:"text-xl font-bold",children:["#",v]})]})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-2 mb-6",children:[(0,t.jsx)("button",{className:"px-4 py-2 rounded-lg ".concat("overview"===N?"bg-blue-600":"bg-gray-700"),onClick:()=>w("overview"),children:"Overview"}),(0,t.jsx)("button",{className:"px-4 py-2 rounded-lg ".concat("portfolio"===N?"bg-blue-600":"bg-gray-700"),onClick:()=>w("portfolio"),children:"Portfolio"}),(0,t.jsx)("button",{className:"px-4 py-2 rounded-lg ".concat("history"===N?"bg-blue-600":"bg-gray-700"),onClick:()=>w("history"),children:"History"}),(0,t.jsx)("button",{className:"px-4 py-2 rounded-lg ".concat("analytics"===N?"bg-blue-600":"bg-gray-700"),onClick:()=>w("analytics"),children:"Analytics"}),(0,t.jsx)("button",{className:"px-4 py-2 rounded-lg ".concat("settings"===N?"bg-blue-600":"bg-gray-700"),onClick:()=>w("settings"),children:"Settings"})]}),"overview"===N&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Overview"}),(0,t.jsxs)("p",{children:["Portfolio Value: $",x]}),(0,t.jsxs)("p",{children:["Returns: ",f,"%"]}),(0,t.jsxs)("p",{children:["Rank: #",v]}),(0,t.jsxs)("p",{children:["Number of Assets: ",C.length]}),(0,t.jsxs)("p",{children:["Number of Transactions: ",_.length]}),(0,t.jsx)(n.x1,{data:{labels:["Jan","Feb","Mar","Apr","May","Jun"],datasets:[{label:"Portfolio Value",data:[1e3,1200,1500,1800,2e3,2200],backgroundColor:"rgba(255, 99, 132, 0.2)",borderColor:"rgba(255, 99, 132, 1)",borderWidth:1}]},options:{scales:{y:{beginAtZero:!0}}}})]}),"portfolio"===N&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Portfolio"}),0===C.length?(0,t.jsx)("p",{children:"No assets found."}):(0,t.jsx)("ul",{children:C.map(e=>(0,t.jsxs)("li",{onClick:()=>el(e),className:"cursor-pointer hover:bg-gray-700 p-2 rounded",children:[e.asset,": ",e.amount]},e.id))}),S&&(0,t.jsxs)("div",{className:"mt-4 p-4 bg-gray-800 rounded",children:[(0,t.jsx)("h3",{className:"text-lg font-bold",children:S.asset}),(0,t.jsxs)("p",{children:["Amount: ",S.amount]})]})]}),"history"===N&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-4",children:"History"}),0===_.length?(0,t.jsx)("p",{children:"No transactions found."}):(0,t.jsx)("ul",{children:_.map(e=>(0,t.jsxs)("li",{children:[e.type,": ",e.asset," -"," ",e.amount," @ ",e.price]},e.id))})]}),"analytics"===N&&(0,t.jsxs)("div",{children:[(0,t.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Analytics"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-bold mb-2",children:"Asset Distribution"}),(0,t.jsx)(n.by,{data:{labels:C.map(e=>e.asset),datasets:[{label:"Asset Distribution",data:C.map(e=>e.amount),backgroundColor:["rgba(255, 99, 132, 0.2)","rgba(54, 162, 235, 0.2)","rgba(255, 206, 86, 0.2)","rgba(75, 192, 192, 0.2)","rgba(153, 102, 255, 0.2)","rgba(255, 159, 64, 0.2)"],borderColor:["rgba(255, 99, 132, 1)","rgba(54, 162, 235, 1)","rgba(255, 206, 86, 1)","rgba(75, 192, 192, 1)","rgba(153, 102, 255, 1)","rgba(255, 159, 64, 1)"],borderWidth:1}]},options:{scales:{y:{beginAtZero:!0}}}})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-bold mb-2",children:"Price Chart"}),S&&(0,t.jsx)(n.x1,{data:{labels:["Jan","Feb","Mar","Apr","May","Jun"],datasets:[{label:S.asset,data:[100,120,150,180,200,220],backgroundColor:"rgba(255, 99, 132, 0.2)",borderColor:"rgba(255, 99, 132, 1)",borderWidth:1}]},options:{scales:{y:{beginAtZero:!0}}}})]})]})]}),"// Settings Tab","settings"===N&&(0,t.jsxs)("div",{className:"w-full max-w-md",children:[(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block mb-1 text-sm",children:"Name"}),(0,t.jsx)("input",{type:"text",value:c,onChange:e=>u(e.target.value),className:"w-full p-2 bg-gray-700 rounded"})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("label",{className:"block mb-1 text-sm",children:"Email"}),(0,t.jsx)("input",{type:"email",placeholder:"Enter email",value:m,onChange:e=>h(e.target.value),className:"w-full p-2 bg-gray-700 rounded"})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-bold mb-2",children:"Change Password"}),(0,t.jsx)("input",{type:"password",placeholder:"Current Password",className:"w-full p-2 bg-gray-700 rounded mb-2",value:q,onChange:e=>J(e.target.value)}),(0,t.jsx)("input",{type:"password",placeholder:"New Password",className:"w-full p-2 bg-gray-700 rounded mb-2",value:Z,onChange:e=>U(e.target.value)}),(0,t.jsx)("input",{type:"password",placeholder:"Confirm New Password",className:"w-full p-2 bg-gray-700 rounded mb-2",value:F,onChange:e=>W(e.target.value)}),(0,t.jsx)("button",{className:"bg-primary px-4 py-2 rounded",onClick:D,children:"Update Password"})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-bold mb-2",children:"Notifications"}),(0,t.jsxs)("label",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:H,onChange:()=>B("email")}),"Email notifications"]}),(0,t.jsxs)("label",{className:"flex items-center gap-2 mt-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:T,onChange:()=>B("sms")}),"SMS notifications"]})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-bold mb-2",children:"Price Alerts"}),(0,t.jsxs)("label",{className:"flex items-center gap-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:P,onChange:et}),"Enable Price Alerts"]})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-bold mb-2",children:"Two-Factor Auth"}),(0,t.jsx)("button",{className:"bg-primary px-4 py-2 rounded",onClick:es,children:L?"Disable 2FA":"Enable 2FA"}),Q&&(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{dangerouslySetInnerHTML:{__html:Q}}),(0,t.jsx)("input",{placeholder:"Enter code from app",onChange:e=>ea(e.target.value)})]})]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-bold mb-2",children:"Linked Accounts"}),er.map(e=>(0,t.jsxs)("p",{children:[e.provider,": Connected"]},e.id))]}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-bold mb-2 text-red-500",children:"Danger Zone"}),(0,t.jsx)("button",{className:"bg-red-500 px-4 py-2 rounded",onClick:en,children:"Delete Account"})]}),(0,t.jsx)("button",{onClick:M,className:"bg-primary px-4 py-2 rounded",children:"Save Changes"}),(0,t.jsx)("div",{className:"flex justify-center md:justify-start mt-4",children:(0,t.jsxs)("button",{onClick:()=>e.push("/dashboard"),className:"text-gray-400 hover:text-white transition-colors",children:[(0,t.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 inline-block mr-1",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Back to Dashboard"]})})]})]})]})}},6634:function(e,s,a){"use strict";a.d(s,{O:function(){return t}});let t=(0,a(3053).eI)("https://hvdssadhwzrazjxvdpce.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh2ZHNzYWRod3pyYXpqeHZkcGNlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc5OTE4MDQsImV4cCI6MjA4MzU2NzgwNH0.ctPsE2BnZEgS4u4PWWgXvy-Hql6VjQjZSmTCUqCBOQ8")}},function(e){e.O(0,[674,303,840,971,117,744],function(){return e(e.s=2719)}),_N_E=e.O()}]);