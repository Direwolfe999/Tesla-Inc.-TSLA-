(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{7943:function(e,t,r){Promise.resolve().then(r.bind(r,2849))},2849:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return f}});var a=r(7437),s=r(2265),l=r(6634),i=r(9376),n=r(9064),o=r(7208),c=r(3464),d=()=>{let[e,t]=(0,s.useState)([]),r=["bitcoin","ethereum","cardano","polkadot","avalanche-2","chainlink","litecoin","stellar","dogecoin","solana","matic-network","shiba-inu","tron","eos","monero","dash","zcash","bitcoin-cash","ethereum-classic","neo","nem","stellar-lumens","waves","qtum","komodo","steem","stratis","verge","pivx","reddcoin","binancecoin","uniswap","chainlink","aave","cosmos","tezos","theta","hedera-hashgraph","vechain","icon","waves","komodo","stratis"],a=["AAPL","MSFT","NVDA","JPM","V","PYPL","TSLA"],i=async()=>{try{let e=localStorage.getItem("prices"),s=localStorage.getItem("timestamp");if(e&&s){let r=parseInt(s,10);if(Date.now()-r<18e4){t(JSON.parse(e));return}}let{data:i}=await c.Z.get("https://api.coingecko.com/api/v3/coins/markets",{params:{vs_currency:"usd",ids:r.join(",")}}),n=await Promise.all(a.map(async e=>{let{data:t}=await c.Z.get("https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=".concat(e,"&apikey=").concat("HBWKBIE9AIF6IQMO"));return t["Global Quote"]&&t["Global Quote"]["01. symbol"]&&t["Global Quote"]["05. price"]?{symbol:e+"/USD",name:t["Global Quote"]["01. symbol"],price:parseFloat(t["Global Quote"]["05. price"])}:(console.error("Error fetching ".concat(e," price:"),t),{symbol:e+"/USD",name:e,price:0})})),o=[...i.map(e=>({symbol:e.symbol+"/USD",name:e.name,price:e.current_price})),...n];for(let e of(localStorage.setItem("prices",JSON.stringify(o)),localStorage.setItem("timestamp",Date.now().toString()),o))await l.O.from("coins").upsert({symbol:e.symbol,name:e.name,price:e.price});let{data:d}=await l.O.from("coins").select("*");d&&t(d)}catch(e){console.error(e)}};return(0,s.useEffect)(()=>{i();let e=setInterval(i,6e4);return()=>clearInterval(e)},[]),e},m=()=>{let[e,t]=(0,s.useState)(!1),[r,i]=(0,s.useState)({name:"",symbol:"",price:0,amount:""}),[c,m]=(0,s.useState)(!1),[u,p]=(0,s.useState)(null),[b,h]=(0,s.useState)(0),x=d();(0,s.useEffect)(()=>{l.O.auth.getSession().then(e=>{let{data:{session:t}}=e;if(!t){n.ZP.error("Please sign in first");return}p(t.user)})},[]),(0,s.useEffect)(()=>{(null==u?void 0:u.id)&&l.O.from("wallets").select("balance").eq("user_id",u.id).single().then(e=>{let{data:t}=e;t&&h(t.balance)})},[u]),(0,s.useEffect)(()=>{if(!(null==u?void 0:u.id))return;let e=l.O.channel("wallets").on("postgres_changes",{event:"UPDATE",schema:"public",table:"wallets"},e=>{e.new.user_id===u.id&&h(e.new.balance)}).subscribe();return()=>{l.O.removeChannel(e)}},[null==u?void 0:u.id]);let f=e=>{i(t=>({...t,name:e.name,symbol:e.symbol,price:e.price})),m(!1)},g=r.amount?(r.price*parseFloat(r.amount)).toFixed(2):"0.00",y=async e=>{let{data:t,error:r}=await l.O.from("wallets").select("*").eq("user_id",e).single();if(r&&"PGRST116"===r.code){let{error:t}=await l.O.from("wallets").insert([{user_id:e,balance:0}]);if(t)throw t}else if(r)throw r;return!0},v=async e=>{if(e.preventDefault(),!u)return n.ZP.error("Please sign in first");if(!r.amount||0>=Number(r.amount))return n.ZP.error("Enter a valid amount");if(b<r.price*Number(r.amount))return n.ZP.error("Insufficient balance");t(!0);try{await y(u.id);let{error:e}=await l.O.rpc("buy_crypto",{p_user_id:u.id,p_asset:r.symbol,p_amount:Number(r.amount),p_price:r.price,p_max_slippage:1.05});if(e)throw e;n.ZP.success("".concat(r.name," purchased successfully!")),i(e=>({...e,amount:""}))}catch(e){n.ZP.error(e.message||"Purchase failed")}finally{t(!1)}};return(0,a.jsxs)("div",{className:"max-w-md mx-auto p-4",children:[(0,a.jsx)("div",{className:"flex justify-center mb-16",children:(0,a.jsx)(o.Z,{})}),(0,a.jsx)("div",{className:"mb-4 text-white",children:(0,a.jsxs)("p",{children:["Wallet Balance: $",b.toLocaleString()]})}),(0,a.jsxs)("form",{onSubmit:v,children:[(0,a.jsxs)("div",{className:"mb-4 relative",children:[(0,a.jsxs)("div",{onClick:()=>m(e=>!e),className:"cursor-pointer text-white bg-transparent border border-dark_border border-opacity-60 rounded-md px-3 py-2 text-start flex justify-between items-center",children:[r.name,(0,a.jsx)("span",{className:"ml-2",children:c?"▲":"▼"})]}),c&&(0,a.jsx)("div",{className:"absolute z-10 bg-dark border border-dark_border border-opacity-60 mt-1 rounded-md w-full max-h-48 overflow-y-auto",children:x.length>0?x.map(e=>(0,a.jsx)("div",{onClick:()=>f(e),className:"px-3 bg-dark_grey text-white hover:text-darkmode py-2 hover:bg-primary cursor-pointer",children:e.name},e.symbol)):(0,a.jsx)("div",{className:"px-3 py-2 text-white",children:"No coins available"})})]}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("input",{type:"text",name:"price",className:"text-white bg-transparent border border-dark_border border-opacity-60 rounded-md px-3 py-2 w-full focus:border-primary focus-visible:outline-0",value:"$".concat(r.price.toLocaleString()),disabled:!0,required:!0})}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("input",{type:"number",name:"amount",placeholder:"Amount",value:r.amount,onChange:e=>{let{name:t,value:r}=e.target;"amount"===t&&i(e=>({...e,amount:r}))},min:"0",required:!0,className:"text-white bg-transparent border border-dark_border border-opacity-60 rounded-md px-3 py-2 w-full focus:border-primary focus-visible:outline-0"})}),(0,a.jsxs)("div",{className:"flex justify-between mb-4 text-white",children:[(0,a.jsx)("p",{children:"Total Cost: "}),(0,a.jsxs)("p",{children:["$",g]})]}),(0,a.jsx)("button",{type:"submit",className:"text-darkmode font-medium text-18 bg-primary w-full border border-primary rounded-lg py-3 hover:text-primary hover:bg-transparent",disabled:e,children:e?"Processing...":"Buy"})]})]})},u=()=>{let[e,t]=(0,s.useState)(!1),[r,i]=(0,s.useState)({name:"",symbol:"",price:0,amount:""}),[c,m]=(0,s.useState)(!1),[u,p]=(0,s.useState)(null),[b,h]=(0,s.useState)(0),x=d();(0,s.useEffect)(()=>{l.O.auth.getSession().then(e=>{let{data:{session:t}}=e;if(!t){n.ZP.error("Please sign in first");return}p(t.user)})},[]),(0,s.useEffect)(()=>{(null==u?void 0:u.id)&&l.O.from("wallets").select("balance").eq("user_id",u.id).single().then(e=>{let{data:t}=e;t&&h(t.balance)})},[u]),(0,s.useEffect)(()=>{if(!(null==u?void 0:u.id))return;let e=l.O.channel("wallets").on("postgres_changes",{event:"UPDATE",schema:"public",table:"wallets"},e=>{e.new.user_id===u.id&&h(e.new.balance)}).subscribe();return()=>{l.O.removeChannel(e)}},[null==u?void 0:u.id]);let f=e=>{i(t=>({...t,name:e.name,symbol:e.symbol,price:e.price})),m(!1)};r.amount&&(r.price*parseFloat(r.amount)).toFixed(2);let g=async e=>{if(e.preventDefault(),!u){n.ZP.error("User not loaded yet");return}let a=Number(r.amount);if(!a||a<=0){n.ZP.error("Enter a valid amount to sell");return}t(!0);let s=parseFloat(r.price.toString());try{let{error:e}=await l.O.rpc("sell_crypto",{p_user_id:u.id,p_asset:r.symbol,p_amount:a,p_price:s,p_min_receive:a*s*.95});if(e)throw e;n.ZP.success("Crypto sold successfully!"),i(e=>({...e,amount:""}))}catch(e){n.ZP.error(e.message||"Sell failed"),console.error(e)}finally{t(!1)}};return(0,a.jsxs)("div",{className:"max-w-md mx-auto p-4",children:[(0,a.jsx)("div",{className:"flex justify-center mb-16",children:(0,a.jsx)(o.Z,{})}),(0,a.jsx)("div",{className:"mb-4 text-white",children:(0,a.jsxs)("p",{children:["Wallet Balance: $",b.toLocaleString()]})}),(0,a.jsxs)("form",{onSubmit:g,children:[(0,a.jsxs)("div",{className:"mb-4 relative",children:[(0,a.jsxs)("div",{onClick:()=>m(e=>!e),className:"cursor-pointer text-white bg-transparent border border-dark_border border-opacity-60 rounded-md px-3 py-2 text-start flex justify-between items-center",children:[r.name,(0,a.jsx)("span",{className:"ml-2",children:c?"▲":"▼"})]}),c&&(0,a.jsx)("div",{className:"absolute z-10 bg-dark border border-dark_border border-opacity-60 mt-1 rounded-md w-full max-h-48 overflow-y-auto",children:x.length>0?x.map(e=>(0,a.jsx)("div",{onClick:()=>f(e),className:"px-3 bg-dark_grey text-white hover:text-darkmode py-2 hover:bg-primary cursor-pointer",children:e.name},e.symbol)):(0,a.jsx)("div",{className:"px-3 py-2 text-white",children:"No coins available"})})]}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("input",{type:"text",name:"price",className:"text-white bg-transparent border border-dark_border border-opacity-60 rounded-md px-3 py-2 w-full focus:border-primary focus-visible:outline-0",value:"$".concat(r.price.toLocaleString()),disabled:!0,required:!0})}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsx)("input",{type:"number",name:"amount",placeholder:"Amount",value:r.amount||0,onChange:e=>{let{name:t,value:r}=e.target;i(e=>({...e,[t]:r}))},min:"0",required:!0,className:"text-white bg-transparent border border-dark_border border-opacity-60 rounded-md px-3 py-2 w-full focus:border-primary focus-visible:outline-0"})}),(0,a.jsxs)("div",{className:"flex justify-between mb-4 text-white",children:[(0,a.jsx)("p",{children:"Total Price: "}),(0,a.jsxs)("p",{children:["$",r.price*Number(r.amount||0)]})]}),(0,a.jsx)("button",{type:"submit",className:"hover:text-darkmode font-medium text-18 bg-transparent w-full border border-primary rounded-lg py-3 text-primary hover:bg-primary",disabled:e,children:e?"Processing...":"Sell"})]})]})},p=r(7648),b=r(9764),h=r(476),x=r(3359),f=()=>{let e=(0,i.useRouter)(),[t,r]=(0,s.useState)(null),[n,o]=(0,s.useState)(0),[c,d]=(0,s.useState)([]),[f,g]=(0,s.useState)([]),[y,v]=(0,s.useState)(!1),[j,w]=(0,s.useState)(!1),N=(0,s.useRef)(null),_=(0,s.useRef)(null),[k,S]=(0,s.useState)(null),[P,O]=(0,s.useState)([]),[I,E]=(0,s.useState)(6),C={},q=async()=>{try{let e=C.news;if(e&&e.timestamp>Date.now()-6e4){O(e.data);return}let t=await fetch("https://www.alphavantage.co/query?function=NEWS_SENTIMENT&tickers=AAPL&apikey=HBWKBIE9AIF6IQMO"),r=await t.json();r.feed?(C.news={timestamp:Date.now(),data:r.feed},O(r.feed)):console.error("Invalid API response:",r)}catch(e){console.error(e)}};(0,s.useEffect)(()=>{l.O.auth.getSession().then(t=>{let{data:a}=t;if(!a.session)return e.push("/auth/signin");r(a.session.user),Z(a.session.user.id),B(a.session.user.id),q()})},[]),(0,s.useEffect)(()=>{if(t){l.O.from("profiles").select("*").eq("id",t.id).single().then(e=>{let{data:t}=e;return S(t)});let e=l.O.channel("profiles").on("postgres_changes",{event:"UPDATE",schema:"public",table:"profiles",filter:"id=eq.".concat(t.id)},e=>{S(e.new)}).subscribe();return()=>{e.unsubscribe()}}},[t]);let Z=async e=>{await Promise.all([A(e),D(e)])},A=async e=>{let{data:t,error:r}=await l.O.from("wallets").select("balance").eq("user_id",e).single();!r&&t?o(t.balance):console.error("Error fetching balance:",r)},D=async e=>{let{data:t,error:r}=await l.O.from("transactions").select("*").eq("user_id",e).order("created_at",{ascending:!1});!r&&t&&(d(t),L(t))},B=e=>{l.O.channel("wallet-realtime").on("postgres_changes",{event:"*",schema:"public",table:"wallets",filter:"user_id=eq.".concat(e)},e=>{var t;(null===(t=e.new)||void 0===t?void 0:t.balance)!==void 0&&o(Number(e.new.balance))}).subscribe(),l.O.channel("tx-realtime").on("postgres_changes",{event:"*",schema:"public",table:"transactions",filter:"user_id=eq.".concat(e)},t=>D(e)).subscribe()},L=e=>{let t={};e.forEach(e=>{t[e.asset]||(t[e.asset]={asset:e.asset,quantity:0,value:0});let r="buy"===e.type?e.amount:-e.amount;t[e.asset].quantity+=r,t[e.asset].value+=r*e.price}),g(Object.values(t).filter(e=>e.quantity>0))};return t?(0,a.jsxs)("div",{className:"max-w-6xl mx-auto mt-40 text-white space-y-8 bg-gradient-to-b from-gray-900 to-violet-950 min-h-screen",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold",children:"Dashboard"}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)(p.default,{href:"/profile",children:(0,a.jsx)("img",{src:(null==k?void 0:k.profile_pic_url)||"/default-avatar.jpg",alt:"Profile Pic",className:"w-10 h-10 rounded-full cursor-pointer",title:"Profile"})})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"bg-dark_grey p-6 rounded-lg",children:[(0,a.jsx)("h2",{className:"text-2xl mb-3",children:"Balance"}),(0,a.jsxs)("p",{className:"text-4xl font-bold text-primary",children:[" ","$",n.toFixed(2)," "]})]}),(0,a.jsxs)("div",{className:"bg-dark_grey p-6 rounded-lg",children:[(0,a.jsx)("h2",{className:"text-2xl mb-3",children:"Actions"}),(0,a.jsxs)("div",{className:"flex gap-6",children:[(0,a.jsx)("button",{onClick:()=>v(!0),className:"bg-primary px-6 py-2 rounded-lg",children:"Buy Assets"}),(0,a.jsx)("button",{onClick:()=>w(!0),className:"border border-primary px-6 py-2 rounded-lg text-primary",children:"Sell Assets"})]})]})]}),(0,a.jsxs)("div",{className:"bg-dark_grey p-6 rounded-lg",children:[(0,a.jsx)("h2",{className:"text-2xl mb-3",children:"Stock News"}),0===P.length?(0,a.jsx)("p",{children:"No news available"}):(0,a.jsx)("div",{className:"block md:hidden",children:(0,a.jsx)(b.tq,{modules:[h.tl],pagination:{clickable:!0},spaceBetween:20,slidesPerView:1,children:P.map((e,t)=>(0,a.jsx)(b.o5,{children:(0,a.jsxs)("div",{className:"bg-gray-800 p-4 rounded-lg",children:[e.banner_image&&(0,a.jsx)("img",{src:e.banner_image,alt:e.title,className:"w-full h-32 object-cover rounded-t-lg"}),(0,a.jsx)("h3",{className:"text-lg font-bold mt-2",children:e.title}),(0,a.jsx)("p",{className:"text-sm text-gray-400",children:e.summary}),(0,a.jsx)("a",{href:e.url,className:"text-primary hover:underline text-sm",children:"Read more"})]})},t))})}),(0,a.jsxs)("div",{className:"hidden md:block",children:[(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:P.slice(0,I).map((e,t)=>(0,a.jsxs)("div",{className:"bg-gray-800 p-4 rounded-lg",children:[e.banner_image&&(0,a.jsx)("img",{src:e.banner_image,alt:e.title,className:"w-full h-32 object-cover rounded-t-lg"}),(0,a.jsx)("h3",{className:"text-lg font-bold mt-2",children:e.title}),(0,a.jsx)("p",{className:"text-sm text-gray-400",children:e.summary}),(0,a.jsx)("a",{href:e.url,className:"text-primary hover:underline text-sm",children:"Read more"})]},t))}),I<P.length&&(0,a.jsx)("button",{onClick:()=>E(I+6),className:"mt-4 bg-primary text-white px-4 py-2 rounded-lg",children:"Load more"})]})]}),(0,a.jsxs)("div",{className:"bg-dark_grey p-6 rounded-lg",children:[(0,a.jsx)("h2",{className:"text-2xl mb-3",children:"Transaction History"}),(0,a.jsx)("ul",{className:"space-y-2 max-h-64 overflow-y-auto",children:c.map(e=>{var t;return(0,a.jsxs)("li",{className:"p-2 rounded ".concat("buy"===e.type?"bg-green-600":"bg-red-600"),children:[null===(t=e.type)||void 0===t?void 0:t.toUpperCase()," ",e.amount," ",e.asset," @ $",e.price]},e.id)})}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(x.CSVLink,{data:c,filename:"transactions.csv",className:"bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded",children:"Export CSV"})})]}),y&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center",children:(0,a.jsxs)("div",{ref:N,className:"bg-dark_grey p-6 rounded-lg",children:[(0,a.jsx)(m,{}),(0,a.jsx)("button",{onClick:()=>v(!1),children:"Close"})]})}),j&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center",children:(0,a.jsxs)("div",{ref:_,className:"bg-dark_grey p-6 rounded-lg",children:[(0,a.jsx)(u,{}),(0,a.jsx)("button",{onClick:()=>w(!1),children:"Close"})]})})]}):(0,a.jsx)("p",{className:"text-white",children:"Loading..."})}},7208:function(e,t,r){"use strict";var a=r(7437),s=r(3950),l=r(3145),i=r(7648);t.Z=()=>(0,a.jsx)(i.default,{href:"/",children:(0,a.jsx)(l.default,{src:"".concat((0,s.p)(),"images/logo/logo.svg"),alt:"logo",width:160,height:50,style:{width:"auto",height:"auto"},quality:100})})},6634:function(e,t,r){"use strict";r.d(t,{O:function(){return a}});let a=(0,r(3053).eI)("https://hvdssadhwzrazjxvdpce.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh2ZHNzYWRod3pyYXpqeHZkcGNlIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc5OTE4MDQsImV4cCI6MjA4MzU2NzgwNH0.ctPsE2BnZEgS4u4PWWgXvy-Hql6VjQjZSmTCUqCBOQ8")},3950:function(e,t,r){"use strict";r.d(t,{p:function(){return a}});let a=()=>"/Crypgo/"}},function(e){e.O(0,[609,303,643,918,971,117,744],function(){return e(e.s=7943)}),_N_E=e.O()}]);